#pragma once

#include "onnx/attribute.hpp"
#include "types.h"

enum class OpType {
    Abs,
    Acos,
    Acosh,
    Add,
    AffineGrid,
    And,
    ArgMax,
    ArgMin,
    Asin,
    Asinh,
    Atan,
    Atanh,
    AveragePool,
    BatchNormalization,
    Bernoulli,
    BitShift,
    BitwiseAnd,
    BitwiseNot,
    BitwiseOr,
    BitwiseXor,
    BlackmanWindow,
    Cast,
    CastLike,
    Ceil,
    Celu,
    CenterCropPad,
    Clip,
    Col2Im,
    Compress,
    Concat,
    ConcatFromSequence,
    Constant,
    ConstantOfShape,
    Conv,
    ConvInteger,
    ConvTranspose,
    Cos,
    Cosh,
    CumSum,
    DFT,
    DeformConv,
    DepthToSpace,
    DequantizeLinear,
    Det,
    Div,
    Dropout,
    DynamicQuantizeLinear,
    Einsum,
    Elu,
    Equal,
    Erf,
    Exp,
    Expand,
    EyeLike,
    Flatten,
    Floor,
    GRU,
    Gather,
    GatherElements,
    GatherND,
    Gelu,
    Gemm,
    GlobalAveragePool,
    GlobalLpPool,
    GlobalMaxPool,
    Greater,
    GreaterOrEqual,
    GridSample,
    GroupNormalization,
    HammingWindow,
    HannWindow,
    HardSigmoid,
    HardSwish,
    Hardmax,
    Identity,
    If,
    ImageDecoder,
    InstanceNormalization,
    IsInf,
    IsNaN,
    LRN,
    LSTM,
    LayerNormalization,
    LeakyRelu,
    Less,
    LessOrEqual,
    Log,
    LogSoftmax,
    Loop,
    LpNormalization,
    LpPool,
    MatMul,
    MatMulInteger,
    Max,
    MaxPool,
    MaxRoiPool,
    MaxUnpool,
    Mean,
    MeanVarianceNormalization,
    MelWeightMatrix,
    Min,
    Mish,
    Mod,
    Mul,
    Multinomial,
    Neg,
    NegativeLogLikelihoodLoss,
    NonMaxSuppression,
    NonZero,
    Not,
    OneHot,
    Optional,
    OptionalGetElement,
    OptionalHasElement,
    Or,
    PRelu,
    Pad,
    Pow,
    QLinearConv,
    QLinearMatMul,
    QuantizeLinear,
    RNN,
    RandomNormal,
    RandomNormalLike,
    RandomUniform,
    RandomUniformLike,
    Range,
    Reciprocal,
    ReduceL1,
    ReduceL2,
    ReduceLogSum,
    ReduceLogSumExp,
    ReduceMax,
    ReduceMean,
    ReduceMin,
    ReduceProd,
    ReduceSum,
    ReduceSumSquare,
    RegexFullMatch,
    Relu,
    Reshape,
    Resize,
    ReverseSequence,
    RoiAlign,
    Round,
    STFT,
    Scan,
    Scatter,
    ScatterElements,
    ScatterND,
    Selu,
    SequenceAt,
    SequenceConstruct,
    SequenceEmpty,
    SequenceErase,
    SequenceInsert,
    SequenceLength,
    SequenceMap,
    Shape,
    Shrink,
    Sigmoid,
    Sign,
    Sin,
    Sinh,
    Size,
    Slice,
    Softmax,
    SoftmaxCrossEntropyLoss,
    Softplus,
    Softsign,
    SpaceToDepth,
    Split,
    SplitToSequence,
    Sqrt,
    Squeeze,
    StringConcat,
    StringNormalizer,
    StringSplit,
    Sub,
    Sum,
    Tan,
    Tanh,
    TfIdfVectorizer,
    ThresholdedRelu,
    Tile,
    TopK,
    Transpose,
    Trilu,
    Unique,
    Unsqueeze,
    Upsample,
    Where,
    Xor,
    Onnx_ML_ArrayFeatureExtractor,
    Onnx_ML_Binarizer,
    Onnx_ML_CastMap,
    Onnx_ML_CategoryMapper,
    Onnx_ML_DictVectorizer,
    Onnx_ML_FeatureVectorizer,
    Onnx_ML_Imputer,
    Onnx_ML_LabelEncoder,
    Onnx_ML_LinearClassifier,
    Onnx_ML_LinearRegressor,
    Onnx_ML_Normalizer,
    Onnx_ML_OneHotEncoder,
    Onnx_ML_SVMClassifier,
    Onnx_ML_SVMRegressor,
    Onnx_ML_Scaler,
    Onnx_ML_TreeEnsemble,
    Onnx_ML_TreeEnsembleClassifier,
    Onnx_ML_TreeEnsembleRegressor,
    Onnx_ML_ZipMap,
    Onnx_Preview_Training_Adagrad,
    Onnx_Preview_Training_Adam,
    Onnx_Preview_Training_Gradient,
    Onnx_Preview_Training_Momentum,
};

struct Node {
    char *name, *domain, *doc_string;
    OpType op_type;
    char **input_names;
    char **output_names;
    u32 input_count;
    u32 output_count;

    Attribute *attributes;
    u32 attribute_count;
};

void serialize_node(FILE *file, const Node &node);
void deserialize_node(FILE *file, Node &node);
void free_node(Node &node);
